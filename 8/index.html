<!doctype html>
<meta charset="utf-8" />
<style>
    body {
        margin: 0;
        overflow: hidden;
        position: fixed;
        left: 0;
        right: 0;
        top: 0;
        bottom: 0;
    }

    svg {
        position: absolute;
        left: 50%;
        top: 50%;
        overflow: visible;
    }
</style>

<svg></svg>

<script src="../d3/d3.min.js"></script>
<script>
    "use strict";
    var gap = 30;
    var svg = d3.select("svg")
        .attr("width", 100)
        .attr("height", 100)
    function Arrow(cx, cy) {
        this.r = 15;
        this.front = -2;
        this.end = 1 - this.front;
        this.cx = cx * gap;
        this.cy = cy * gap;
        this.arrow = svg.append("line")
            .attr("x1", this.cx - this.r * this.end)
            .attr("y1", this.cy)
            .attr("x2", this.cx + this.r * this.front)
            .attr("y2", this.cy)
            .style("stroke", "black")
    }

    Arrow.prototype.setFace = function (x, y) {
        if (Math.abs(this.cx) > window.screen.width / 2 + this.r / 2 || Math.abs(this.cy) > window.screen.height / 2 + this.r / 2) {
            return;
        }
        var r = Math.sqrt((x - this.cx) * (x - this.cx) + (y - this.cy) * (y - this.cy));
        if (r < 1) {
            return;
        }
        var cos = (x - this.cx) / r;
        var sin = (y - this.cy) / r;
        this.arrow
            .attr("x1", this.cx - cos * this.r * this.end)
            .attr("y1", this.cy - sin * this.r * this.end)
            .attr("x2", this.cx + cos * this.r * this.front)
            .attr("y2", this.cy + sin * this.r * this.front)
    }

    var Arrows = [];

    for (var i = -Math.floor(window.screen.width / 2 / gap); i <= Math.floor(window.screen.width / 2 / gap); i++) {
        for (var j = -Math.floor(window.screen.height / 2 / gap); j <= Math.floor(window.screen.height / 2 / gap); j++) {
            Arrows.push(new Arrow(i, j));
        }
    }

    function towards(event) {
        Arrows.forEach(function (a) {
            a.setFace(event.clientX - window.innerWidth / 2, event.clientY - window.innerHeight / 2);
        })
    }
    document.body.onmousemove = towards;

</script>